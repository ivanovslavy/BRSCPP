# Developer Support Guide (DEV_SUPPORT)

This document provides a **structured, README-style technical guide** for the full end‑to‑end integration flow of a merchant using the **BRSCPP (Blockchain Real-time Settlement Crypto Payment Protocol)**.

# BRSCPP Merchant Integration Flow

This guide outlines an example real-world integration for a merchant: **Ivan's Digital Shop**, which wants to accept non-custodial crypto payments without managing private keys and no KYC verification.

## Overview

BRSCPP enables merchants to accept cryptocurrency payments with:

* **Non-custodial settlement** (funds go directly to merchant wallet)
* **Chainlink-based price quote locking (60 seconds)**
* **Smart-contract–secured transactions**
* **REST API integration**
* **Webhook notifications** for payment completion

This guide covers the complete merchant flow:

1. Merchant registration
2. Backend integration (Node.js example)
3. Frontend integration (React example)
4. Customer payment experience
5. Webhook event processing
6. Optional polling fallback
7. Full process flow summary

---

## 1. Merchant Registration

**Registration Page:** `https://pp.slavy.space/register`

The merchant connects their preferred wallet (MetaMask or compatible EVM wallet) and submits the registration form.

**Example Wallet Address:**

0x742d35Cc6634C0532925a3b844Bc454e4438f44e

### API Key

After registration, the merchant receives a **unique API Key** (shown only once). Example:

```
pk_test_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```

This key should be stored securely in environment variables:

**dotenv**
BRSCPP_API_KEY=pk_test_a1b2c3...

## 2. Backend Integration (Node.js Example)

Below is a real-world backend implementation that:

* Accepts a checkout request
* Retrieves product details
* Creates a payment request via BRSCPP API
* Stores the payment entry locally
* Returns the checkout URL to the frontend

**javascript**
const express = require('express');
const axios = require('axios');
require('dotenv').config();

const app = express();
app.use(express.json());

const BRSCPP_API_URL = 'https://api.pp.slavy.space';
const BRSCPP_API_KEY = process.env.BRSCPP_API_KEY;

app.post('/checkout', async (req, res) => {
  const { productId, customerEmail } = req.body;

  const product = await getProductFromDatabase(productId);

  try {
    const response = await axios.post(
      `${BRSCPP_API_URL}/api/merchant/payment-request`,
      {
        orderId: `ORDER-${Date.now()}-${productId}`,
        amountUsd: product.price.toString(),
        description: `Payment for ${product.name}`,
        customerEmail
      },
      {
        headers: {
          Authorization: `Bearer ${BRSCPP_API_KEY}`,
          'Content-Type': 'application/json'
        }
      }
    );

    const paymentRequest = response.data.paymentRequest;

    await savePaymentToDatabase({
      orderId: paymentRequest.orderId,
      productId,
      amount: paymentRequest.amountUsd,
      status: 'pending',
      paymentUrl: paymentRequest.paymentUrl,
      brscppPaymentId: paymentRequest.id
    });

    res.json({
      success: true,
      paymentUrl: paymentRequest.paymentUrl,
      orderId: paymentRequest.orderId
    });
  } catch (error) {
    console.error('BRSCPP payment creation failed:', error);
    res.status(500).json({ error: 'Payment creation failed' });
  }
});

app.listen(3000);

***

## 3. Frontend Integration (React Example)

A simple checkout page initiating the crypto payment request.

**javascript**
function CheckoutPage({ product }) {
  const [loading, setLoading] = useState(false);

  const handleCryptoPayment = async () => {
    setLoading(true);

    try {
      const response = await fetch('https://ivanshop.com/checkout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          productId: product.id,
          customerEmail: 'customer@example.com'
        })
      });

      const data = await response.json();
      window.location.href = data.paymentUrl;
    } catch (error) {
      alert('Payment failed');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <h2>{product.name}</h2>
      <p>Price: ${product.price}</p>
      <button onClick={handleCryptoPayment} disabled={loading}>
        {loading ? 'Redirecting...' : 'Pay with Crypto'}
      </button>
    </div>
  );
}

***

## 4. Customer Payment Flow

Once redirected to the BRSCPP payment page, the customer completes the following steps:

### Process

1. Customer visits checkout URL:

   * `https://app.pp.slavy.space/checkout/ORDER-xxxx-PROD-123`
2. Clicks **Get Price Quote**
3. Chainlink Oracle fetches the live market price
4. Crypto amount is calculated and locked for 60 seconds
5. Customer approves the transaction in MetaMask
6. Smart Contract splits the payment:

   * **99.5% → Merchant Wallet**
   * **0.5% → Fee Collector**

A simplified settlement diagram:

Customer Wallet --> Gateway Contract --> |99.5%| Merchant Wallet
                                      \-> |0.5%| Fee Collector


## 5. Webhook Notification

Merchants receive real-time webhook events when payment is completed.

### Webhook Registration

**bash**
curl -X POST https://api.pp.slavy.space/api/merchant/webhook \
  -H "Authorization: Bearer pk_test_a1b2..." \
  -H "Content-Type: application/json" \
  -d '{
    "webhookUrl": "https://ivanshop.com/webhook/brscpp",
    "webhookSecret": "my_secret_key_12345"
  }'

***

### Webhook Handler (Node.js)

***javascript***
const crypto = require('crypto');

app.post('/webhook/brscpp', express.json(), async (req, res) => {
  const signature = req.headers['x-webhook-signature'];
  const payload = JSON.stringify(req.body);

  const expectedSignature = crypto
    .createHmac('sha256', 'my_secret_key_12345')
    .update(payload)
    .digest('hex');

  if (signature !== expectedSignature) {
    return res.status(401).send('Invalid signature');
  }

  const { event, payment } = req.body;

  if (event === 'payment.completed') {
    await updateOrderStatus(payment.orderId, 'paid');
    await deliverProduct(payment.orderId);
    await sendConfirmationEmail(payment.orderId);
  }

  res.status(200).send('OK');
});

***

### Example Webhook Payload

***json***
{
  "event": "payment.completed",
  "payment": {
    "id": "uuid-123",
    "orderId": "ORDER-1732456789-PROD-123",
    "merchantAddress": "0x742d35Cc6634C0532925a3b844Bc454e4438f44e",
    "usdAmount": 99.99,
    "txHash": "0xabc123def456...",
    "timestamp": "2025-11-24T15:30:00Z"
  }
}

***

## 6. Alternative: Polling Payment Status

If the merchant cannot use webhooks, they may poll:

***javascript***
async function checkPaymentStatus(orderId) {
  const response = await axios.get(
    `https://api.pp.slavy.space/api/customer/payment/${orderId}/status`
  );

  if (response.data.status === 'completed') {
    await deliverProduct(orderId);
    return true;
  }
  return false;
}

***

## 7. Real-World Flow Summary

Customer -> Ivan's Frontend -> Ivan's Backend -> BRSCPP API -> Payment Page
   |                                                           |
   |                          Smart Contract Settlement        |
   +-----------------------------> Blockchain -----------------+
                                                             |
                                        Webhook -> Backend -> Order Delivered


## Need Assistance?

If you need help integrating BRSCPP, contact the support team via:

* Main site: [https://pp.slavy.space](https://pp.slavy.space)
* Dev contact: [https://me.slavy.space](https://me.slavy.space)


**This DEV_SUPPORT document is intended for developers who need a clear, technical, production-ready integration reference for BRSCPP.**
