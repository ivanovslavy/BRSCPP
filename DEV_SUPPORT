# Developer Support Guide (DEV_SUPPORT)

**Version:** 2.1  
**Author:** Slavcho Ivanov  
**Last Updated:** December 24, 2025

Comprehensive technical guide for integrating **BRSCPP v2.1** into merchant applications.

---

## Table of Contents

1. [Overview](#overview)
2. [Quick Start](#quick-start)
3. [Merchant Registration](#merchant-registration)
4. [Backend Integration](#backend-integration)
5. [Frontend Integration](#frontend-integration)
6. [Customer Payment Flow](#customer-payment-flow)
7. [Webhook Integration](#webhook-integration)
8. [Payment Status Polling](#payment-status-polling)
9. [NFT Gift System](#nft-gift-system)
10. [Multi-Currency Support](#multi-currency-support)
11. [Network and Token Support](#network-and-token-support)
12. [Testing Resources](#testing-resources)
13. [Error Handling](#error-handling)
14. [Complete Flow Diagram](#complete-flow-diagram)
15. [Best Practices](#best-practices)
16. [Support](#support)

---

## Overview

BRSCPP v2.1 enables merchants to accept cryptocurrency, credit card (Stripe), and PayPal payments through a unified API.

### Key Features

**Payment Methods:**
- Cryptocurrency payments (ETH, BNB, MATIC, USDC, USDT)
- Credit card payments via Stripe Connect
- PayPal payments via Commerce Platform
- Unified webhook notifications for all payment types

**Technical Capabilities:**
- Non-custodial settlement (P2P wallet-to-wallet)
- Multi-chain support (Ethereum Sepolia, BSC Testnet, Polygon Amoy)
- Multi-currency pricing (12 fiat currencies with automatic USD conversion)
- Direct stablecoin transfers (310% cost reduction)
- Chainlink oracle price validation
- NFT gift rewards for all successful payments

**Authentication Options:**
- Email/password registration and login
- Web3 wallet authentication (MetaMask)
- Wallet linking to existing accounts
- API key authentication for integrations

---

## Quick Start

### Five-Minute Integration
```javascript
// 1. Install dependencies
npm install axios

// 2. Create payment request
const axios = require('axios');

const response = await axios.post(
  'https://api.brscpp.slavy.space/api/merchant/payment-request',
  {
    orderId: 'ORDER-123',
    amount: 100.00,
    currency: 'USD',
    description: 'Product purchase'
  },
  {
    headers: {
      'Authorization': 'Bearer YOUR_API_KEY',
      'Content-Type': 'application/json'
    }
  }
);

// 3. Redirect customer to payment URL
window.location.href = response.data.paymentUrl;

// 4. Receive webhook when payment completes
// POST https://yourstore.com/webhook/brscpp
```

---

## Merchant Registration

### Option 1: Email/Password Registration
```bash
curl -X POST https://api.brscpp.slavy.space/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "merchant@example.com",
    "password": "SecurePassword123",
    "companyName": "My Store"
  }'
```

### Option 2: Web3 Wallet Registration

**Step 1: Get Nonce**
```bash
curl -X POST https://api.brscpp.slavy.space/api/auth/web3/nonce \
  -H "Content-Type: application/json" \
  -d '{"walletAddress": "0x..."}'
```

**Step 2: Sign Message (Frontend)**
```javascript
const message = `Sign in to BRSCPP Merchant Dashboard\n\nNonce: ${nonce}\nAddress: ${walletAddress}`;
const signature = await signer.signMessage(message);
```

**Step 3: Register**
```bash
curl -X POST https://api.brscpp.slavy.space/api/auth/web3/register \
  -H "Content-Type: application/json" \
  -d '{
    "walletAddress": "0x...",
    "signature": "0x...",
    "nonce": "abc123...",
    "companyName": "My Store",
    "email": "optional@email.com"
  }'
```

### Option 3: Dashboard UI

Visit https://merchant-dashboard.brscpp.slavy.space/register

- Choose Email or Web3 registration
- Web3: Connect MetaMask → Fill company details
- Email: Fill all fields → Submit

### API Key Generation

**Via Dashboard:**
1. Login to https://merchant-dashboard.brscpp.slavy.space
2. Navigate to API Keys
3. Click "Create New Key"
4. Copy key (shown only once!)

**Via API:**
```bash
# Login to get JWT token
TOKEN=$(curl -s -X POST https://api.brscpp.slavy.space/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"merchant@example.com","password":"SecurePassword123"}' | jq -r '.token')

# Create API key
curl -X POST https://api.brscpp.slavy.space/api/merchant/apikeys \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "Production API Key", "environment": "live"}'
```

**Response:**
```json
{
  "success": true,
  "apiKey": "brscpp_live_abc123def456...",
  "keyPrefix": "brscpp_live_abc1",
  "name": "Production API Key"
}
```

---

## Backend Integration

### Node.js Express Example
```javascript
const express = require('express');
const axios = require('axios');
require('dotenv').config();

const app = express();
app.use(express.json());

const BRSCPP_API_URL = 'https://api.brscpp.slavy.space';
const BRSCPP_API_KEY = process.env.BRSCPP_API_KEY;

// Create payment request
app.post('/api/checkout', async (req, res) => {
  const { productId, customerEmail, currency, quantity } = req.body;

  try {
    const product = await db.products.findOne({ id: productId });
    const totalAmount = product.price * quantity;
    const orderId = `ORDER-${Date.now()}-${productId}`;

    const response = await axios.post(
      `${BRSCPP_API_URL}/api/merchant/payment-request`,
      {
        orderId: orderId,
        amount: totalAmount,
        currency: currency || 'USD',
        description: `${quantity}x ${product.name}`,
        customerEmail: customerEmail
      },
      {
        headers: {
          'Authorization': `Bearer ${BRSCPP_API_KEY}`,
          'Content-Type': 'application/json'
        }
      }
    );

    // Save to database
    await db.payments.insert({
      orderId: orderId,
      amountUsd: response.data.amountUsd,
      status: 'pending',
      paymentUrl: response.data.paymentUrl
    });

    res.json({
      success: true,
      orderId: orderId,
      paymentUrl: response.data.paymentUrl,
      allowedMethods: response.data.allowedMethods
    });

  } catch (error) {
    console.error('Payment creation failed:', error.response?.data || error.message);
    res.status(500).json({ error: 'Payment creation failed' });
  }
});

app.listen(3000);
```

### Payment Request Parameters

**Required:**
- `orderId` - Unique order identifier (string)
- `amount` - Payment amount (number)

**Optional:**
- `currency` - Fiat currency code (default: "USD")
- `description` - Payment description (string)
- `customerEmail` - Customer email (string)
- `metadata` - Custom data (object)

**Response:**
```json
{
  "success": true,
  "orderId": "ORDER-123",
  "paymentUrl": "https://payment.brscpp.slavy.space/checkout/ORDER-123",
  "amountUsd": "108.70",
  "amountOriginal": 100.00,
  "currencyOriginal": "EUR",
  "exchangeRate": 1.087,
  "allowedMethods": ["crypto", "stripe", "paypal"],
  "expiresAt": "2025-12-25T12:00:00.000Z"
}
```

---

## Customer Payment Flow

### Payment Methods

Customer chooses between:
- **Cryptocurrency** - ETH, BNB, MATIC, USDC, USDT
- **Stripe** - Credit/Debit cards
- **PayPal** - PayPal account

### Cryptocurrency Flow

1. Connect wallet (MetaMask)
2. Select network (Sepolia, BSC, Amoy)
3. Select token (Native or Stablecoin)
4. Confirm payment transaction
5. Payment confirmed on blockchain
6. Webhook sent to merchant

### Stripe Flow

1. Redirect to Stripe Checkout
2. Enter card details
3. Complete payment
4. Webhook sent to merchant

### PayPal Flow

1. Redirect to PayPal
2. Login and approve
3. Complete payment
4. Webhook sent to merchant

---

## Webhook Integration

### Configure Webhook

**Via Dashboard:**
Settings → Webhook URL → Save

**Via API:**
```bash
curl -X PUT https://api.brscpp.slavy.space/api/merchant/webhook \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "webhookUrl": "https://yourstore.com/webhook/brscpp",
    "webhookSecret": "your_webhook_secret"
  }'
```

### Webhook Handler
```javascript
const crypto = require('crypto');

app.post('/webhook/brscpp', express.json(), async (req, res) => {
  // Verify signature
  const signature = req.headers['x-brscpp-signature'];
  const payload = JSON.stringify(req.body);
  
  const expected = 'sha256=' + crypto
    .createHmac('sha256', 'your_webhook_secret')
    .update(payload)
    .digest('hex');

  if (signature !== expected) {
    return res.status(401).send('Invalid signature');
  }

  const { event, payment } = req.body;

  if (event === 'payment.completed') {
    // Update order status
    await db.orders.update(
      { orderId: payment.orderId },
      { 
        status: 'paid',
        txHash: payment.txHash,
        network: payment.network,
        usdAmount: payment.usdAmount
      }
    );

    // Fulfill order
    await fulfillOrder(payment.orderId);
  }

  res.status(200).json({ received: true });
});
```

### Webhook Payload
```json
{
  "event": "payment.completed",
  "payment": {
    "id": "uuid",
    "orderId": "ORDER-123",
    "txHash": "0xabc123...",
    "usdAmount": 108.70,
    "network": "sepolia",
    "customerAddress": "0x123...",
    "tokenAmount": "108.700000"
  },
  "timestamp": "2025-12-24T10:30:00.000Z"
}
```

### Webhook Headers
```
Content-Type: application/json
X-BRSCPP-Event: payment.completed
X-BRSCPP-Signature: sha256=abc123...
```

---

## Multi-Currency Support

### Supported Currencies

USD, EUR, GBP, JPY, CNY, RUB, INR, CAD, AUD, BRL, MXN, KRW

### Currency Conversion Example
```javascript
const response = await axios.post(
  'https://api.brscpp.slavy.space/api/merchant/payment-request',
  {
    orderId: 'ORDER-EUR-123',
    amount: 100.00,
    currency: 'EUR'
  },
  { headers: { 'Authorization': 'Bearer YOUR_API_KEY' } }
);

// Response:
// amountOriginal: 100.00
// currencyOriginal: "EUR"
// amountUsd: "108.70"
// exchangeRate: 1.087
```

---

## Network and Token Support

### Networks

| Network | Chain ID | Status |
|---------|----------|--------|
| Ethereum Sepolia | 11155111 | ✅ Active |
| BSC Testnet | 97 | ✅ Active |
| Polygon Amoy | 80002 | ✅ Active |

### Tokens

**Native:** ETH, BNB, MATIC  
**Stablecoins:** USDC, USDT (310% lower gas)

### Smart Contract Addresses

**Payment Gateway:**
- Sepolia: `0x31b80790726c88f342447DA710fa814d41B141Dd`
- BSC: `0xee6162f759A647351aB71c7296Fd02bDe7534074`
- Amoy: `0xC4De068C028127bdB44670Edb82e6E3Ff4113E49`

**NFT Gift:**
- Sepolia: `0x3699fcA271bE686f8501aDba0f24dDa4358ebbAA`
- BSC: `0xF166733eD46F7A7185A31eC6E0D6b74C06c57ff8`
- Amoy: `0xD24a89dc1686C2F88d33A70250473495459C564a`

---

## Testing Resources

### Test Token Faucets

**BRSCPP Tokens:** https://brscpp.slavy.space/faucets
- USDC: 10,000 per claim
- USDT: 10,000 per claim
- Cooldown: 24 hours

**Native Tokens:**
- Sepolia ETH: https://sepoliafaucet.com
- BSC BNB: https://testnet.bnbchain.org/faucet-smart

### Demo Shop

https://testshop-frontend.brscpp.slavy.space

### Test Credentials

**Dashboard:** https://merchant-dashboard.brscpp.slavy.space
```
Email: demo@brscpp.com
Password: testuser01
```

---

## Error Handling

### HTTP Status Codes

| Code | Description |
|------|-------------|
| 200 | Success |
| 400 | Invalid parameters |
| 401 | Invalid authentication |
| 404 | Resource not found |
| 409 | Duplicate order ID |
| 500 | Server error |

### Common Errors

| Code | Solution |
|------|----------|
| INVALID_API_KEY | Check API key |
| DUPLICATE_ORDER_ID | Use unique order IDs |
| INVALID_CURRENCY | Use supported currency |
| PAYMENT_NOT_FOUND | Verify order ID |

---

## Complete Flow Diagram
```
┌──────────────────────────────────────────────────────────────┐
│  1. Customer → Merchant: Initiate checkout                   │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  2. Merchant → BRSCPP API: Create payment request            │
│     POST /api/merchant/payment-request                       │
│     Response: { paymentUrl, allowedMethods }                 │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  3. Customer → Payment Page: Select payment method           │
│     payment.brscpp.slavy.space/checkout/ORDER-123            │
└──────────────────────────────────────────────────────────────┘
                              │
            ┌─────────────────┼─────────────────┐
            ▼                 ▼                 ▼
      ┌──────────┐      ┌──────────┐      ┌──────────┐
      │  Crypto  │      │  Stripe  │      │  PayPal  │
      │ MetaMask │      │ Checkout │      │ Checkout │
      └────┬─────┘      └────┬─────┘      └────┬─────┘
           │                 │                 │
           └─────────────────┼─────────────────┘
                             ▼
┌──────────────────────────────────────────────────────────────┐
│  4. BRSCPP → Merchant: Webhook notification                  │
│     POST /webhook/brscpp                                     │
│     { event: "payment.completed", payment: {...} }           │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  5. Merchant: Fulfill order                                  │
│     - Update database                                        │
│     - Send confirmation email                                │
│     - Deliver product/service                                │
└──────────────────────────────────────────────────────────────┘
```

---

## Best Practices

### Security

- Store API keys in environment variables
- Always verify webhook signatures
- Use HTTPS endpoints only
- Rotate API keys periodically

### Performance

- Cache exchange rates (5-minute TTL)
- Index order IDs in database
- Implement retry logic with backoff

### User Experience

- Show clear payment instructions
- Provide transaction hash after payment
- Link to block explorer
- Mobile-responsive checkout

---

## Support

### Links

| Resource | URL |
|----------|-----|
| Documentation | https://brscpp.slavy.space |
| Dashboard | https://merchant-dashboard.brscpp.slavy.space |
| Demo Shop | https://testshop-frontend.brscpp.slavy.space |
| GitHub | https://github.com/ivanovslavy/BRSCPP |
| Contact | https://me.slavy.space |

---

**Last Updated:** December 24, 2025  
**Document Version:** 2.1  
**Author:** Slavcho Ivanov
